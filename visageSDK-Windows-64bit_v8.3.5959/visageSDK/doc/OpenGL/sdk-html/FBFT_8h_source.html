<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>visageSDK: FBFT.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">visageSDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_d824261317fb699cf4b8f35dd7e294f7.html">FBFT</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">FBFT.h</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// </span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// (c) Visage Technologies AB 2002 - 2016  All rights reserved. </span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// </span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// This file is part of visage|SDK(tm). </span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// Unauthorized copying of this file, via any medium is strictly prohibited. </span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// </span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// No warranty, explicit or implicit, provided. </span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// </span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// This is proprietary software. No part of this software may be used or </span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// reproduced in any form or by any means otherwise than in accordance with</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// any written license granted by Visage Technologies AB. </span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// </span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">//FBFT.h</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">//declaration of the face tracker class</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#ifndef FBFT_H</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#define FBFT_H</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">//#define _CRTDBG_MAP_ALLOC //MEMORY LEAK DEBUGGING</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">//#include &lt;stdlib.h&gt;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">//#include &lt;crtdbg.h&gt;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">// The following ifdef block is the standard way of creating macros which make exporting</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">// from a DLL simpler. All files within this DLL are compiled with the VISAGETRACKER_EXPORTS</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">// symbol defined on the command line. this symbol should not be defined on any project</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">// that uses this DLL. This way any other project whose source files include this file see</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">// VISAGE_DECLSPEC functions as being imported from a DLL, wheras this DLL sees symbols</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">// defined with this macro as being exported.</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#ifdef VISAGE_STATIC</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">        #define VISAGE_DECLSPEC</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">        #ifdef VISAGE_EXPORTS</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">                #define VISAGE_DECLSPEC __declspec(dllexport)</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">        #else</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">                #define VISAGE_DECLSPEC __declspec(dllimport)</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">        #endif</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#define SOFTWARE_RENDERING</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#ifdef SOFTWARE_RENDERING</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;SwrTexture.h&quot;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">// define to use Extended Information Filter</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &lt;cv.h&gt;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#ifdef EMSCRIPTEN</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &lt;cstddef&gt;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &lt;highgui.h&gt;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="comment">// definitions from EKF.h</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">        #define LIMIT_R_VALUE 100000.0f //points whose R value is bigger or equal to this value are not processed</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="comment">//from types.h (FaceTracker 2)</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="keyword">typedef</span> <span class="keywordtype">float</span> f32;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="keyword">typedef</span> <span class="keywordtype">double</span> f64;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="keyword">typedef</span> <span class="keywordtype">char</span> is8;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> iu8;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="keyword">typedef</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> is16;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> iu16;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="keyword">typedef</span> <span class="keywordtype">int</span> is32;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iu32;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="keyword">typedef</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> is64;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> iu64;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        </div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#include &quot;ExtendedInformationFilter.h&quot;</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#include &quot;FaceModelNoVel.h&quot;</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="preprocessor">#include &quot;FDP.h&quot;</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">//from func.h</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#include &lt;fstream&gt;</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">#include &lt;sstream&gt;</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">//face normalization</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor">#define VS_NORM_POSE    0x00</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#define VS_NORM_SU              0x01</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor">#define VS_NORM_AU              0x02</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">//from func_gl.h</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor">#if defined(WIN32)</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">#define NOMINMAX</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#include &lt;windows.h&gt;</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">//#define ENABLE_OPENGL</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor">#ifdef ENABLE_OPENGL</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor">#include &lt;GL/gl.h&gt;</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">#include &lt;GL/glu.h&gt;</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="preprocessor">#if defined(MAC_OS_X)</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="preprocessor">#define ENABLE_OPENGL</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="preprocessor">#ifdef ENABLE_OPENGL</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="preprocessor">#include &lt;OpenGL/OpenGL.h&gt;</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="preprocessor">#include &lt;OpenGL/glu.h&gt;</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="preprocessor">#if defined(LINUX)</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="preprocessor">#define ENABLE_OPENGL</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="preprocessor">#ifdef ENABLE_OPENGL</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="preprocessor">#include &lt;GL/gl.h&gt;</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="preprocessor">#include &lt;GL/glu.h&gt;</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceVisageSDK.html">VisageSDK</a></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;{</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="keyword">class </span>VisageDetector;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="keyword">class </span>VisageTracker;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="keyword">struct </span>FaceData;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="classVisageSDK_1_1FBFT.html">  137</a></span>&#160;<span class="keyword">class </span>VISAGE_DECLSPEC <a class="code" href="classVisageSDK_1_1FBFT.html">FBFT</a></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;{</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="keyword">friend</span> <span class="keyword">class </span>VisageDetector;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classVisageSDK_1_1VisageTracker.html">VisageTracker</a>;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classVisageSDK_1_1VisageFeaturesDetector.html">VisageFeaturesDetector</a>;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="keyword">friend</span> <span class="keyword">class </span>ModelFitter;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="keyword">friend</span> <span class="keyword">class </span>PoseEstimator;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="comment">//constructor</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <a class="code" href="classVisageSDK_1_1FBFT.html">FBFT</a> (</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                );</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="comment">//destructor</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        ~<a class="code" href="classVisageSDK_1_1FBFT.html">FBFT</a> (</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                );</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="comment">//initialisation</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="keywordtype">bool</span> init (</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;settings <span class="comment">//settings to be used</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                );</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordtype">void</span> init_image_sizes (</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;settings, <span class="comment">//settings to be used</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                iu32 frame_width, <span class="comment">//width of video image</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                iu32 frame_height <span class="comment">//height of video image</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                );</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keywordtype">void</span> reInitialiseFromEyeAndMouthPos(IplImage* frame,<a class="code" href="classVisageSDK_1_1FDP.html">FDP</a> *fp);</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="keywordtype">void</span> fitModelToFeaturePoints(<a class="code" href="classVisageSDK_1_1FDP.html">FDP</a> *fp,<span class="keywordtype">int</span> imageWidth, <span class="keywordtype">int</span> imageHeight);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="keywordtype">void</span> calculatePose(<a class="code" href="classVisageSDK_1_1FDP.html">FDP</a> *fp, <span class="keywordtype">float</span> *rot, <span class="keywordtype">float</span> *tran,<span class="keywordtype">float</span> aspect,<span class="keywordtype">float</span> &amp;s,<span class="keywordtype">float</span> &amp;edi,<span class="keywordtype">float</span> &amp;end, <span class="keywordtype">float</span> &amp;emd);</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="comment">//initiate tracker with a first frame, update tracker with a new frame, or just project the vertices</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="keywordtype">void</span> update (</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                <span class="comment">/*const */</span>IplImage* frame, <span class="comment">//a frame, if 0 only projection is done</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                <span class="keywordtype">bool</span> track <span class="comment">//0: initiate tracker with first frame, 1: update tracker with new frame</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                );</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="comment">//check if r, t or au are out of their boundaries</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="keywordtype">bool</span> bad_states (</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                );</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="comment">//initiate feature points using a frame, should be private</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keywordtype">bool</span> init_feature_points (</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                <span class="keyword">const</span> IplImage* frame <span class="comment">//frame used to extract feature points</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                );</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="comment">//find feature points in a masked image</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keywordtype">int</span> find_good_feature_points (</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                <span class="keyword">const</span> IplImage* image_color, <span class="comment">//color image</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                <span class="keyword">const</span> IplImage* mask, <span class="comment">//the mask</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                iu32 ROI_index <span class="comment">//current ROI</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                );</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="comment">//set predefined feature points</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordtype">int</span> set_feature_points (</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                iu32 ROI_index <span class="comment">//current ROI</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                );</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="comment">//find_point for all feature points</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordtype">void</span> find_points (</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                CvMat* search_range,</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                CvMat* method, <span class="comment">// matching method to use</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                f32* maximum_values, <span class="comment">// array to store maximum match values for each point, normalised with respect to initial values</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                iu32* use_tex, <span class="comment">// flag for each point, if 1 textured image is used for search, if 0 previous frame is used</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                iu32* point_visible, <span class="comment">// flag for each point, if 1 point is visible, if 0 point is hidden so don&#39;t try to find it</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                <span class="keywordtype">bool</span> refine_step = <span class="keyword">false</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                );</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="comment">// Estimate eye closure based on iris match values</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="keywordtype">void</span> processEyesClosure(IplImage* frame, <a class="code" href="classVisageSDK_1_1FDP.html">FDP</a>* fdp, <span class="keywordtype">float</span>* out);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="comment">// compute the valuse of the eye closing AU that performs full eye closing</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordtype">void</span> compute_full_eye_closure();</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="comment">//set the ekf R values depending on the result of feature point matching</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="keywordtype">void</span> set_ekf_R (</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                f32* _max_vals</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        );</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="comment">// resize the data matrices for the current number of tracked featured points</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keywordtype">void</span> resize (</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                iu32 _points_num</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                );</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <span class="comment">//model</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        CvMat* g; <span class="comment">//fix model vertices</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        CvMat* g0; <span class="comment">//original version of fix model vertices, needed for re-initialisation</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        CvMat* Su; <span class="comment">//shape unit matrix</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        CvMat* Au; <span class="comment">//action unit matrix</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        CvMat* tri; <span class="comment">//model surface triangles</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        CvMat* au_use; <span class="comment">//list of action units actually to use, boolean behaviour</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="keywordtype">string</span>* au_names;<span class="comment">//list of action units names, currently not used //can be used with au_num to determine max array size //added by Pilipovic</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="keywordtype">size_t</span> au_names_count;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        f32 f; <span class="comment">// Camera focus</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        f32 s; <span class="comment">//scale</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        f32 r[3]; <span class="comment">//array of xyz rotation angles</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        f32 t[3]; <span class="comment">//array of xyz translations</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        f32 r_prev[3]; <span class="comment">//array of xyz previous frame rotation angles</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        f32 t_prev[3]; <span class="comment">//array of xyz previous frame translations</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        f32 tzinit; <span class="comment">//z translation at initialisation</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        f32 dIinit; <span class="comment">//eye distance in projection space at initialisation</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        CvMat* su; <span class="comment">//shape unit vector</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        CvMat* au; <span class="comment">// action unit vector</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        CvMat* vertex0; <span class="comment">//model vertices after shape and action units have been added</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        CvMat* vertex1; <span class="comment">//model vertices after scaling, rotation and translation</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        CvMat* vertexN; <span class="comment">//model vertices in neutral face</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        CvMat* projection;  <span class="comment">// Projected model vertices. The 2D coordinates of the model vertices projected onto the display window. The coordinates are normalised to the window height: 0,0 is in the center of the window; Y coordinate of the upper edge is 1, Y coordinate of the lower edge is -1, X coordinate of the left edge is equal to -aspect ratio of the image, and the X coordinate of the right edge is equal to the aspect ratio of the image.</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="preprocessor">#ifdef EMSCRIPTEN</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="preprocessor">#else </span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">//private:</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        CvMat* current_tex_coord;  <span class="comment">//current texture coordintes; calculated on demand by getTexCoord(). These coordinates are a simple normalisation of coordinates in projection</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="comment">//texture</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        iu32 tex_size; <span class="comment">//size of the texture (size times size pixels, size = power of 2)</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        CvMat** tex_coord; <span class="comment">//texture coordinates, one CvMat* for each used texture</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        iu32 tex_num; <span class="comment">//number of textures used</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        CvMat* tri_tex; <span class="comment">//texture name (index) for each triangle</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="comment">//point finding</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        iu32 gl_width; <span class="comment">//width of opengl buffer</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        iu32 gl_height; <span class="comment">//height of opengl buffer</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        iu32 fast_image_resize;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        iu32 init_gl_width; <span class="comment">//width of opengl buffer for initialisation (feature points choosing)</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        iu32 init_gl_height; <span class="comment">//height of opengl buffer for initialisation (feature points choosing)</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        iu32 ROI_num; <span class="comment">//number of Regions of Interest (ROI)</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        CvMat* min_distance; <span class="comment">//the wanted minimum distance between feature points (float, one per ROI)</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        CvMat* block_size; <span class="comment">//size of averaging block used in opencv func to extract feature points (int, one per ROI)</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        CvMat** tri_index; <span class="comment">//list of triangle indices forming the mask in which feature points may be inserted (list of integers, one list per ROI)</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        CvMat* bound_rect_modifiers; <span class="comment">//mask bounding rectangle modifiers, float, four per ROI</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        CvMat* max_points_num_ROI; <span class="comment">//maximum number of feature points to use for each ROI, int</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        CvMat* ROI_init_angle; <span class="comment">//ROI track points initialisation angle (float, one per ROI)</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        CvMat* ROI_initialised; <span class="comment">//Flag indicating if the ROI track points have been initialised (int, one per ROI)</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        iu32 max_points_num; <span class="comment">//maximum number of feature points to use in total, for all ROIs</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        iu32 points_num; <span class="comment">// number of feature points actually used</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        iu32 model_points_num; <span class="comment">// number of points (vertices) in the 3D model itself (without the track points)</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        iu32 reserved_points_num; <span class="comment">// number of feature points that are allocated but not yet used</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        CvMat* preset_points_coord; <span class="comment">//set feature point coordinates</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        CvMat* points_preset; <span class="comment">// indexes to array with preset points mapping</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        CvMat* eye_points_coord;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        CvMat* preset_points_ROI;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        CvMat* points_coord; <span class="comment">//feature point coordinates</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        CvMat* points_ROI; <span class="comment">//feature point ROI indices, one int per tracked feature point</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        CvMat* search_range; <span class="comment">//search range (int, two per ROI - x and y) when using prev image to search for feature points</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        CvMat* refine_range; <span class="comment">//search range (int, two per ROI - x and y) when using drawn model to search fro feature points</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        CvMat* patch_size; <span class="comment">//size of the patch (float, one per ROI) to match with (patch_size times patch_size pixels)</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        CvMat* method; <span class="comment">//matching method (int, one per ROI)</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        CvMat* bad_match_threshold; <span class="comment">// minimal match value for a track point (float, one per ROI); corrective action taken when match value falls below threshold</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        f32 global_bad_match_threshold; <span class="comment">// minimum average match value for all track points; if value is below this threshold the tracker will re-initialise</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        iu32 visibility_check; <span class="comment">// are we doing visibility check? 0 = no; 1 = normals; 2 = color coding; 3 = both</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        CvMat* sensitivity_falloff; <span class="comment">// a parameter that controls how fast the tracker sensitivity to a particular track point decreases when the match quality for that point decreases (float, one per ROI). Higher values result in sharper falloff, i.e. by increasing this value the tracker increasingly ignores points with bad match values.</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        f32* max_vals; <span class="comment">// match quality values for each feature point, expressed as ratio to the value from the first frame</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        f32* tex_max_vals; <span class="comment">// match quality values from texture-based matching for each feature point, expressed as ratio to the value from the first frame</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="keywordtype">float</span> tracking_quality; <span class="comment">// match quality average for this frame</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordtype">float</span> tracking_quality_bdts; <span class="comment">// bdts quality average for this frame</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        IplImage* prev_frame; <span class="comment">//the previous frame</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        IplImage* cur_frame; <span class="comment">//the current frame</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        IplImage* prev_frame_full; <span class="comment">//the current frame</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        iu32 n_recovery_frames; <span class="comment">// number of recovery frames to be used</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        iu32 recovery_frames; <span class="comment">// recovery frames counter</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <a class="code" href="classVisageSDK_1_1FDP.html">FDP</a> *fp_corres; <span class="comment">// FDP structure used to store correspondence between MPEG-4 Feature Points and vertices in the 3D model</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <a class="code" href="classVisageSDK_1_1VisageTracker.html">VisageTracker</a> *vt;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="keywordtype">float</span>* init_angle_hyst;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="comment">// eye processing stuff</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        iu32 process_eyes; <span class="comment">// process eye rotation and closure</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        f32 full_eye_closure; <span class="comment">// value of eye closure AU corresponding to full eye closure; set automatically when initialising, after the 3D model has been fitted</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        iu32 eye_closing_au;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        iu32 leye_closing_au; <span class="comment">// AU that closes the eyes; candide hardcoding - should be configurable</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        iu32 reye_closing_au;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        iu32 eye_h_rotation_au; <span class="comment">// AU that horizontaly the eyes; candide hardcoding - should be configurable</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        iu32 eye_v_rotation_au; <span class="comment">// AU that horizontaly the eyes; candide hardcoding - should be configurable</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="keywordtype">float</span> eye_closure[2];</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="comment">//working images</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        IplImage* gl_image_color;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        IplImage* image_color;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        IplImage* image_index;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        IplImage* image;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        IplImage* patch_image_tex; <span class="comment">// patch image created by projecting the textured model</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        iu32 frame_tex_id;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        f32 tex_x_coord;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        f32 tex_y_coord;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        IplImage* result_image_buffer;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="comment">// interpupillary distance</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="keywordtype">float</span> ipd;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <span class="keywordtype">void</span> setIPD(<span class="keywordtype">float</span> value);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keywordtype">float</span> getIPD();</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="keywordtype">float</span> face_scale;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="keywordtype">void</span> setTMSizes(<a class="code" href="classVisageSDK_1_1FDP.html">FDP</a>* featurePoints2D);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> EYE_OPEN_THRESHOLD;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="comment">// n3</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">                for EIF implementation</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">        */</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        SystemModel* n3Sys;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        FaceModel* n3Fm;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <a class="code" href="classVisageSDK_1_1ExtendedInformationFilter.html">ExtendedInformationFilter</a>* n3Eif;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> frame_num;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="keywordtype">void</span> n3_eif_init();</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <span class="keywordtype">void</span> n3_eif_reset(<span class="keyword">const</span> f32* r, <span class="keyword">const</span> f32* t, <span class="keyword">const</span> CvMat* au);</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <span class="keywordtype">void</span> n3_extract_data(<span class="keywordtype">float</span> r[3], <span class="keywordtype">float</span> t[3], CvMat* au, CvMat* x);</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">                ...</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">        */</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="keywordtype">bool</span> ekf_failure; <span class="comment">// set to true when EKF update fails</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        CvMat* ekf_sensitivity; <span class="comment">//the ekf sensitivity for 3 rotations, 3 translations and 14 AUs</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        CvMat* au_gravity; <span class="comment">//A gravity factor, one per each Action Unit, that determines the behavior of the Action Unit in the situation when it is not driven by track points because they are not found (e.g. they are hidden or temporarily lost). In such case, AU value is multiplied by the gravity factor. Therefore, gravity factor 1 is neutral, less than 1 means that AU value will fall (faster if gravity factor is smaller), and a value larger than 1 would make the AU value rise.</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        f32 gravity_threshold; <span class="comment">//Threshold value that determines when the gravity factor starts to influence the Action Units. Then the Kalman gain for all track points influencing the AU falls below this threshold, gravity kicks in.</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        CvMat* points_au; <span class="comment">//An integer matrix of au_num rows and points_num columns determining which track points drive which AU by values of 1 or 0.</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        CvMat* points_Au; <span class="comment">//For each track point, a value of 0 indicates that it does not drive any AUs, value is 1 otherwise.</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        CvMat* points_tri; <span class="comment">//Triangle index for each track point.</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        CvMat* r_limit; <span class="comment">//rotation boundaries</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        CvMat* t_limit; <span class="comment">//translation boundaries</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        CvMat* au_limit; <span class="comment">//action unit boundaries</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        VisageDetector* m_DetectorBDF;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <a class="code" href="classVisageSDK_1_1FDP.html">FDP</a> *featurePoints2D;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="keywordtype">int</span> face_bb_x;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="keywordtype">int</span> face_bb_y;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="keywordtype">int</span> face_bb_x_prev;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="keywordtype">int</span> face_bb_y_prev;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="keywordtype">int</span> face_bb_size;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="keywordtype">int</span> max_face_width;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keywordtype">int</span> face_bb_init;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        <span class="keywordtype">float</span> face_bb_scale;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="keywordtype">int</span> max_work_eye_dist;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordtype">int</span> cur_eye_dist;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        IplImage *face_bb_new;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        IplImage *face_bb_prev;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        IplImage *face_bb_tex;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        CvRect face_bb_rect;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        CvRect face_bb_rect_scaled;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <a class="code" href="classVisageSDK_1_1FDP.html">FDP</a> *fitter_offset;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        f32 find_point_new (</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                IplImage* image, <span class="comment">//image B</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                CvSize search_image_size, <span class="comment">//search image size</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                IplImage* patch_image, <span class="comment">//image A</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                CvSize patch_image_size, <span class="comment">//patch image size</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                IplImage* result_image, <span class="comment">//matching results</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                f32 patch_x, <span class="comment">//feature point coordinate u</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                f32 patch_y, <span class="comment">//feature point coordinate v</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                f32 &amp;x_find, <span class="comment">//new feature point coordinate u, output</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                f32 &amp;y_find, <span class="comment">//new feature point coordinate v, output</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                iu32 method, <span class="comment">//matching method to use</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                iu32 tex_use <span class="comment">// are we using texture or previous frame?</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        );</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="keywordtype">void</span> estimate_eye_rotations (</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                <span class="keywordtype">float</span> f,</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                <span class="keywordtype">float</span> s,</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">float</span>* r,</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">float</span>* t,</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                <span class="keyword">const</span> CvMat* su,</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                <span class="keyword">const</span> CvMat* au,</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                <span class="keyword">const</span> CvMat* g,</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                <span class="keyword">const</span> CvMat* Su,</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                <span class="keyword">const</span> CvMat* Au,</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                CvMat* vertex0,</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                CvMat* vertex1,</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                <span class="keywordtype">int</span>* eye_ind = 0</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        );</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="keywordtype">float</span> r_eye[2]; <span class="comment">//eye rotations</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        <span class="keywordtype">int</span> m_bdts_points_num;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        iu32 m_use_bdts_points;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="keywordtype">int</span> m_bdts_points_inited;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        CvMat* bdts_points_use;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        CvMat* bdts_points_sensitivity;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        CvMat* bdts_points_angle;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        CvMat* bdts_points_nptrb;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <span class="keywordtype">void</span> find_bdts_points(IplImage* frame, <a class="code" href="classVisageSDK_1_1FDP.html">FDP</a>* fdp, CvPoint2D32f* points, <span class="keywordtype">float</span> *vals);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="keywordtype">void</span> init_bdts_points(IplImage* frame, <a class="code" href="classVisageSDK_1_1FDP.html">FDP</a>* fdp);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <span class="keywordtype">int</span> m_LBFPointsNum;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        iu32 m_useLBFPoints;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        <span class="keywordtype">float</span> m_LBFPointsAngle;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="keywordtype">int</span> m_LBFPointsInited;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <span class="keywordtype">void</span> findLBFPoints(IplImage* frame, <a class="code" href="classVisageSDK_1_1FDP.html">FDP</a>* fdp, CvPoint2D32f* points, <span class="keywordtype">float</span>* vals);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <span class="keywordtype">void</span> initLBFPoints(IplImage* frame, <a class="code" href="classVisageSDK_1_1FDP.html">FDP</a>* fdp);</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="keywordtype">void</span> setFDPPointVisibility(<span class="keyword">const</span> <a class="code" href="classVisageSDK_1_1FDP.html">FDP</a>* fdp, <a class="code" href="classVisageSDK_1_1FDP.html">FDP</a>&amp; fdp_vis) <span class="keyword">const</span>;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="keywordtype">void</span> GetQualityNCC(CvPoint2D32f* cur_points, CvPoint2D32f* prev_points, IplImage* cur_frame, IplImage* prev_frame, <span class="keywordtype">float</span>* quality, <span class="keywordtype">int</span> point_num, <span class="keywordtype">int</span> patch_size);</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        IplImage* lbf_ncc_patches;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="keywordtype">bool</span> *lbf_ncc_use_last;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <span class="keywordtype">int</span> *lbf_ncc_frame_diff;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordtype">int</span> *lbf_ncc_patchsize;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        FILE *log_file; <span class="comment">//log file - used for debugging, set via log_filename configuration parameter</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="preprocessor">#pragma region READ_WRITE</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="comment">//from func.h</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="comment">//read a file into a string, returns the string</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="keywordtype">string</span> read_file (</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;filename <span class="comment">//the filename</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                );</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="comment">//write the contents of a string to a file</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="keywordtype">void</span> write_file (</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;filestring, <span class="comment">//the string to be written</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;filename <span class="comment">//the filename</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                );</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="comment">//read a wfm file containing face model data</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="keywordtype">bool</span> read_gSuAu_wfm (</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;file_name <span class="comment">//the filename</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                );</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        <span class="comment">//read profile from string</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="keywordtype">void</span> read_profile (</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;filestring, <span class="comment">//the string</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                <span class="keywordtype">string</span> &amp;texture <span class="comment">// texture image file name, output</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                );</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <span class="comment">//write scale and shape units to file</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <span class="keywordtype">void</span> write_profile (</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;filename,</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                IplImage* texture_image <span class="comment">// texture image</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                );</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="comment">//read rotation, translation and action units from string</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="keywordtype">void</span> read_states (</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;filestring, <span class="comment">//the string</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                f32* r, <span class="comment">//3 sized array of xyz rotation angles</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                f32* t, <span class="comment">//3 sized array of xyz translations</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                CvMat* au <span class="comment">//action unit vector</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                );</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="comment">//write rotation, translation and action units to string, returns the string</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <span class="keywordtype">string</span> write_states (</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                <span class="keyword">const</span> f32* r, <span class="comment">//3 sized array of xyz rotation angles, output</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                <span class="keyword">const</span> f32* t, <span class="comment">//3 sized array of xyz translations, output</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                <span class="keyword">const</span> CvMat* au <span class="comment">//action unit vector, output</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                );</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="comment">//read a setting from a setting string, integer</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <span class="keywordtype">void</span> read_setting (</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;settings, <span class="comment">//setting string</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> name, <span class="comment">//setting name</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                iu32 &amp;value <span class="comment">//setting value, output</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                );</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="comment">//read a setting from a setting string, floating point</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <span class="keywordtype">void</span> read_setting (</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;settings, <span class="comment">//setting string</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> name, <span class="comment">//setting name</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                f32 &amp;value <span class="comment">//setting value, output</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                );</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="comment">//read a setting from a setting string, text</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="keywordtype">void</span> read_setting (</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;settings, <span class="comment">//setting string</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> name, <span class="comment">//setting name</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                <span class="keywordtype">string</span> &amp;value <span class="comment">//setting value, output</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                );</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="comment">//read a setting list (vector) from a setting string, floating point</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="keywordtype">void</span> read_settings_list_f32 (</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;settings, <span class="comment">//setting string</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> name, <span class="comment">//setting name</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                CvMat* list <span class="comment">//list (vector) of values, output</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                );</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="comment">//read a setting list (vector) from a setting string, integer</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keywordtype">void</span> read_settings_list_iu32 (</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;settings, <span class="comment">//setting string</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> name, <span class="comment">//setting name</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                CvMat* list <span class="comment">//list (vector) of values, output</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                );</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <span class="comment">//read a setting array from a setting string, integer</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordtype">void</span> read_setting_array (</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;settings, <span class="comment">//setting string</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> name, <span class="comment">//setting name</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                <span class="keyword">const</span> iu32 n, <span class="comment">//size of array</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                <span class="keywordtype">int</span> *value <span class="comment">//setting value array, output</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                );</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <span class="comment">//read a setting array from a setting string, floating point</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <span class="keywordtype">void</span> read_setting_array (</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;settings, <span class="comment">//setting string</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> name, <span class="comment">//setting name</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                <span class="keyword">const</span> iu32 n, <span class="comment">//size of array</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                <span class="keyword">const</span> iu32 l, <span class="comment">//size of each row</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                <span class="keywordtype">float</span> *value, <span class="comment">//setting value array, output</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                <span class="keywordtype">bool</span> default_first <span class="comment">//if true, default value for any setting that was not found is taken from the first member of array; if false, default values are 0</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                );</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <span class="comment">//read a setting array from a setting string, returns string array of @param size elements</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <span class="keywordtype">void</span> read_settings_list_string(</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;settings, <span class="comment">//setting string</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">string</span> name, <span class="comment">//setting name</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                <span class="keywordtype">int</span> size,</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                <span class="keywordtype">string</span> *list <span class="comment">//list of names, output</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                );</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="preprocessor">#pragma endregion READ_WRITE</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="preprocessor">#pragma region GL</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="comment">//from func_gl.h</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="keywordtype">void</span> gl_swap_rb (</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                IplImage* image</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                );</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        <span class="comment">//set the camera and its view (frustum)</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        <span class="keywordtype">void</span> gl_view (</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                iu32 width, <span class="comment">//width of image to be drawn</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                iu32 height, <span class="comment">//height of image to be drawn</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                f32 f <span class="comment">//focus</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                );</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <span class="comment">//initialize frame texture</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <span class="keywordtype">void</span> gl_init_frame_tex (</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                iu32 x_size,</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                iu32 y_size,</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                <span class="keyword">const</span> IplImage *image</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                );</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <span class="comment">//display video as texture</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        <span class="keywordtype">void</span> gl_display_video (</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                iu32 width,</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                iu32 height,</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                <span class="keyword">const</span> IplImage *image</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                );</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="comment">//load an image to the buffer</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        <span class="keywordtype">void</span> gl_load_image (</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                <span class="keyword">const</span> IplImage* image <span class="comment">//the image to load</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                );</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <span class="comment">//save the buffer to an image</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        <span class="keywordtype">void</span> gl_save_image (</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                IplImage* image <span class="comment">//image to save to, output</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                );</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="comment">//fix model vertices + shape action units + scale rotation translation + projection -&gt; image coordinates</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        <span class="keywordtype">void</span> gl_project (</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                f32 f, <span class="comment">//focus</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                f32 s, <span class="comment">//scale</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                <span class="keyword">const</span> f32* r, <span class="comment">//3 sized array of xyz rotation angles</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                <span class="keyword">const</span> f32* t, <span class="comment">//3 sized array of xyz translations</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                <span class="keyword">const</span> CvMat* su, <span class="comment">//shape unit vector</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                <span class="keyword">const</span> CvMat* au, <span class="comment">//action unit vector</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                <span class="keyword">const</span> CvMat* g, <span class="comment">//fix model vertex list</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                <span class="keyword">const</span> CvMat* Su, <span class="comment">//shape unit matrix</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                <span class="keyword">const</span> CvMat* Au, <span class="comment">//action unit matrix</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                CvMat* vertex0, <span class="comment">//model vertices after shape and action units have been added, output</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                CvMat* vertex1, <span class="comment">//model vertices after scaling, rotation and translation, output</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                CvMat* projection <span class="comment">//projected model vertices, output</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                );</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <span class="comment">//compute and return texture coordinates</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">float</span> *getTexCoord(<span class="keywordtype">float</span> aspect);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <span class="comment">//load an image as an opengl texture and calculate texture coordinates from projection</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        <span class="keywordtype">void</span> gl_set_texture (</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                <span class="keyword">const</span> IplImage* image, <span class="comment">//the texture image</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                iu32 tex_size, <span class="comment">//size of the texture (size times size pixels, size = power of 2)</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                iu32 tex_name, <span class="comment">//number to bind texture with</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                <span class="keyword">const</span> CvMat* projection, <span class="comment">//projected model vertices</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                CvMat** tex_coord <span class="comment">//texture coordinates, output</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                );</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="comment">//draw selected model triangles using their index number (32bit using 3x8bit)</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="keywordtype">void</span> gl_draw_model_tri_index (</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                iu32 width, <span class="comment">//width of drawn image</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                iu32 height, <span class="comment">//height of drawn image</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                f32 f, <span class="comment">//focus</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                <span class="keyword">const</span> CvMat* vertex1, <span class="comment">//model vertices after scaling, rotation and translation</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                <span class="keyword">const</span> CvMat* tri, <span class="comment">//model surface triangles</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                <span class="keyword">const</span> CvMat* tri_index <span class="comment">//list of triangle indices</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                );</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="comment">//draw selected model triangles using a specific color</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        <span class="keywordtype">void</span> gl_draw_model_tri (</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                iu32 width, <span class="comment">//width of drawn image</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                iu32 height, <span class="comment">//height of drawn image</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                f32 f, <span class="comment">//focus</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                <span class="keyword">const</span> CvMat* vertex1, <span class="comment">//model vertices after scaling, rotation and translation</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                <span class="keyword">const</span> CvMat* tri, <span class="comment">//model surface triangles</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                <span class="keyword">const</span> CvMat* tri_index, <span class="comment">//list of triangle indices</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                <span class="keyword">const</span> f32* color <span class="comment">//3 sized array containing the color</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                );</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        <span class="comment">//draw textured model</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        <span class="keywordtype">void</span> gl_draw_model_texture (</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                iu32 width, <span class="comment">//width of drawn image</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                iu32 height, <span class="comment">//height of drawn image</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                f32 f, <span class="comment">//focus</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                <span class="keyword">const</span> CvMat* vertex1, <span class="comment">//model vertices after scaling, rotation and translation</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                <span class="keyword">const</span> CvMat* tri_index, <span class="comment">//list of triangles to draw, indicated by triangle index, or NULL to draw all triangles</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                <span class="keyword">const</span> CvMat** tex_coord <span class="comment">//list of texture coordinates for the vertices; one list for each used texture</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                );</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        <span class="comment">//draw model as a wireframe using a specific color</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <span class="keywordtype">void</span> gl_draw_model_wireframe (</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                iu32 width, <span class="comment">//width of drawn image</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                iu32 height, <span class="comment">//height of drawn image</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                f32 f, <span class="comment">//focus</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                <span class="keyword">const</span> CvMat* vertex1, <span class="comment">//model vertices after scaling, rotation and translation</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                <span class="keyword">const</span> CvMat* tri, <span class="comment">//model surface triangles</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                <span class="keyword">const</span> f32* color <span class="comment">//3 sized array containing the color</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                );</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        <span class="comment">//draw model vertices starting from a specific vertex index using a specific color</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <span class="keywordtype">void</span> gl_draw_points (</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                iu32 width, <span class="comment">//width of drawn image</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                iu32 height, <span class="comment">//height of drawn image</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                f32 f, <span class="comment">//focus</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                <span class="keyword">const</span> CvMat* vertex1, <span class="comment">//model vertices after scaling, rotation and translation</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                iu32 first_point, <span class="comment">//the first vertex index</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                iu32 num_points, <span class="comment">//number of points to draw</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                <span class="keyword">const</span> f32* color, <span class="comment">//3 sized array containing the color</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                f32 point_size, <span class="comment">//size in pixels of the drawn points representing the vertices</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                f32 *color_multiplier <span class="comment">// one value per point, multiplies the color of that point; ignored if NULL</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                );</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="preprocessor">#pragma endregion GL</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="preprocessor">#pragma region SOFTWARE RENDERING</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="preprocessor">        #ifdef SOFTWARE_RENDERING</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="preprocessor">        #define MAX_SWR_TEX 30</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        SwrTexture *swr_texture[MAX_SWR_TEX];</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *zBuffer16;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        <span class="keywordtype">int</span> swrWidth;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="keywordtype">int</span> swrHeight;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        <span class="keywordtype">char</span> *imageData;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *imageData16;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        <span class="keywordtype">void</span> swr_load_image (</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                <span class="keyword">const</span> IplImage* image</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                );</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        <span class="keywordtype">void</span> swr_save_image (</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                IplImage* image</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                );</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="keywordtype">void</span> swr_set_texture (</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                <span class="keyword">const</span> IplImage* image,</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                iu32 tex_size,</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                iu32 tex_name,</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                <span class="keyword">const</span> CvMat* projection,</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                CvMat** tex_coord</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                );</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <span class="keywordtype">void</span> swr_draw_model_tri_index (</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                iu32 width,</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                iu32 height,</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                f32 f,</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                <span class="keyword">const</span> CvMat* vertex1,</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                <span class="keyword">const</span> CvMat* tri,</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                <span class="keyword">const</span> CvMat* tri_index</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                );</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        <span class="keywordtype">void</span> swr_draw_model_texture (</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                iu32 width,</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                iu32 height,</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                f32 f,</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                <span class="keyword">const</span> CvMat* vertex1,</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                <span class="keyword">const</span> CvMat* tri_index,</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                <span class="keyword">const</span> CvMat** tex_coord</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                );</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <span class="keywordtype">void</span> getNormalizedFaceImage (</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                IplImage* frame,</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                IplImage* normFace,</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                f32 f,</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                <span class="keyword">const</span> CvMat* vertex,</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                <span class="keyword">const</span> CvMat* tri_index,</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                <span class="keyword">const</span> CvMat* tex_coord</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        );</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="keywordtype">void</span> getNormalizedFace(</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                IplImage* frame, </div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                IplImage* normFace, </div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                <a class="code" href="structVisageSDK_1_1FaceData.html">FaceData</a>* face_data, </div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                <a class="code" href="classVisageSDK_1_1FDP.html">FDP</a>* normFDP,</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                <span class="keywordtype">int</span> norm_type,</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                CvMat* projection_tmp</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        );</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="preprocessor">        #endif</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="preprocessor">#pragma endregion SOFTWARE RENDERING</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;};</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;}</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="preprocessor">#endif</span></div><div class="ttc" id="classVisageSDK_1_1VisageTracker_html"><div class="ttname"><a href="classVisageSDK_1_1VisageTracker.html">VisageSDK::VisageTracker</a></div><div class="ttdoc">VisageTracker is a face tracker capable of tracking the head pose, facial features and gaze for multi...</div><div class="ttdef"><b>Definition:</b> <a href="VisageTracker_8h_source.html#l00124">VisageTracker.h:124</a></div></div>
<div class="ttc" id="classVisageSDK_1_1FBFT_html"><div class="ttname"><a href="classVisageSDK_1_1FBFT.html">VisageSDK::FBFT</a></div><div class="ttdoc">Low-level face tracker implementation used in VisageTracker. </div><div class="ttdef"><b>Definition:</b> <a href="FBFT_8h_source.html#l00137">FBFT.h:137</a></div></div>
<div class="ttc" id="classVisageSDK_1_1ExtendedInformationFilter_html"><div class="ttname"><a href="classVisageSDK_1_1ExtendedInformationFilter.html">VisageSDK::ExtendedInformationFilter</a></div><div class="ttdoc">: public DynamicFilter </div><div class="ttdef"><b>Definition:</b> <a href="ExtendedInformationFilter_8h_source.html#l00025">ExtendedInformationFilter.h:25</a></div></div>
<div class="ttc" id="classVisageSDK_1_1VisageFeaturesDetector_html"><div class="ttname"><a href="classVisageSDK_1_1VisageFeaturesDetector.html">VisageSDK::VisageFeaturesDetector</a></div><div class="ttdoc">Faces and facial features detector implementation. </div><div class="ttdef"><b>Definition:</b> <a href="VisageFeaturesDetector_8h_source.html#l00069">VisageFeaturesDetector.h:69</a></div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div></div>
<div class="ttc" id="namespaceVisageSDK_html"><div class="ttname"><a href="namespaceVisageSDK.html">VisageSDK</a></div><div class="ttdef"><b>Definition:</b> <a href="win__header_8h_source.html#l00001">win_header.h:1</a></div></div>
<div class="ttc" id="structVisageSDK_1_1FaceData_html"><div class="ttname"><a href="structVisageSDK_1_1FaceData.html">VisageSDK::FaceData</a></div><div class="ttdoc">Face data structure, used as container for all face tracking and detection results. </div><div class="ttdef"><b>Definition:</b> <a href="FaceData_8h_source.html#l00236">FaceData.h:236</a></div></div>
<div class="ttc" id="classVisageSDK_1_1FDP_html"><div class="ttname"><a href="classVisageSDK_1_1FDP.html">VisageSDK::FDP</a></div><div class="ttdoc">Feature points of a face. </div><div class="ttdef"><b>Definition:</b> <a href="FDP_8h_source.html#l00209">FDP.h:209</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
